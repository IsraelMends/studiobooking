name: üì¶ EAS Auto Build on Commit

on:
  push:
    branches:
      - main    # ou altere para sua branch principal (ex: master, develop)

jobs:
  eas-build:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Clona o reposit√≥rio
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2Ô∏è‚É£ Define a vers√£o do Node
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 3Ô∏è‚É£ Instala as depend√™ncias do projeto
      - name: Install dependencies
        run: npm ci

      # 4Ô∏è‚É£ Instala o EAS CLI
      - name: Install EAS CLI
        run: npm install -g eas-cli@latest

      # 5Ô∏è‚É£ Faz login no Expo via token seguro
      - name: Log in to Expo using token
        run: npx eas login --token ${{ secrets.EXPO_TOKEN }}

      # 6Ô∏è‚É£ Roda o build Android automaticamente
      - name: Build Android (Production)
        run: npx eas build --platform android --non-interactive --profile production

      # 7Ô∏è‚É£ Roda o build iOS automaticamente
      - name: Build iOS (Production)
        run: npx eas build --platform ios --non-interactive --profile production

      # 8Ô∏è‚É£ (opcional) Faz upload dos artefatos gerados
      - name: Upload build logs
        uses: actions/upload-artifact@v4
        with:
          name: eas-build-logs
          path: |
            dist
            .eas
            .expo
